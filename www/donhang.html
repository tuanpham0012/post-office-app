<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover, shrink-to-fit=no">
  <meta name="description" content="Suha - Multipurpose Ecommerce Mobile HTML Template">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme-color" content="#100DD1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <!-- The above tags *must* come first in the head, any other head content must come *after* these tags-->
  <!-- Title-->
  <title>Suha - Multipurpose Ecommerce Mobile HTML Template</title>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&amp;display=swap">
  <!-- Favicon-->
  <link rel="icon" href="assets/img/icons/icon-72x72.png">
  <!-- Apple Touch Icon-->
  <link rel="apple-touch-icon" href="img/icons/icon-96x96.png">
  <link rel="apple-touch-icon" sizes="152x152" href="assets/img/icons/icon-152x152.png">
  <link rel="apple-touch-icon" sizes="167x167" href="assets/img/icons/icon-167x167.png">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/img/icons/icon-180x180.png">
  <!-- CSS Libraries-->
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/animate.css">
  <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
  <link rel="stylesheet" href="assets/css/font-awesome.min.css">
  <link rel="stylesheet" href="assets/css/default/lineicons.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <!-- Stylesheet-->
  <link rel="stylesheet" href="style.css">
  <!-- Web App Manifest-->
  <link rel="manifest" href="manifest.json">
  <style>
    .gr-btn {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .btn {
      border: 1px slategrey solid;
    }

    .btn:hover {
      background-color: rgb(240, 228, 240);
    }

    .content {
      font-size: 0.9rem;
      color: black;
      font-weight: 500;
    }
  </style>
</head>

<body>
  <!-- Preloader-->
  <div class="preloader" id="preloader">
    <div class="spinner-grow text-secondary" role="status">
      <div class="sr-only">Loading...</div>
    </div>
  </div>
  <!-- Header Area-->
  <div class="header-area" id="headerArea">
    <div class="container h-100 d-flex align-items-center justify-content-between">
      <!-- Back Button-->
      <div class="back-button"><a href="home.html">
          <svg class="bi bi-arrow-left" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
            viewBox="0 0 16 16">
            <path fill-rule="evenodd"
              d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z">
            </path>
          </svg></a></div>
      <!-- Page Title-->
      <div class="page-heading">
        <h6 class="mb-0">Đơn hàng</h6>
      </div>
      <!-- Navbar Toggler-->
      <div class="suha-navbar-toggler d-flex justify-content-between flex-wrap" id="suhaNavbarToggler">
        <span></span><span></span><span></span>
      </div>
    </div>
  </div>
  <!-- Sidenav Black Overlay-->
  <div class="sidenav-black-overlay"></div>
  <!-- Side Nav Wrapper-->
  <div class="suha-sidenav-wrapper" id="sidenavWrapper">
    <!-- Sidenav Profile-->
    <div class="sidenav-profile">
      <div class="user-profile"><img src="img/user.jpg" alt=""></div>
      <div class="user-info">
        <h6 class="user-name mb-0">Phạm QT</h6>
      </div>
    </div>
    <!-- Sidenav Nav-->
    <ul class="sidenav-nav ps-0">
      <li><a href="#"><i class="lni lni-user"></i>Thông tin tài khoản</a></li>
      <li><a href="#"><i class="lni lni-alarm lni-tada-effect"></i>Nâng cấp VIP</li>
      <li><a href="#"><i class="lni lni-empty-file"></i>Hỗ trợ</a></li>
      <li><a href="#"><i class="lni lni-heart"></i></i>Báo cáo</a></li>
      <li><a href="index.html"><i class="lni lni-power-switch"></i>Đăng xuất</a></li>
    </ul>
    <!-- Go Back Button-->
    <div class="go-home-btn" id="goHomeBtn"><i class="lni lni-arrow-left"></i></div>
  </div>
  <!-- Page Content Wrapper-->
  <div class="page-content-wrapper">
    <div class="container">
      <!-- Section Heading-->
      <div class="section-heading d-flex align-items-center pt-3 justify-content-between">

      </div>
      <!-- Notifications Area-->
      <div class="notification-area pb-2" id="list">
        
      </div>
    </div>
  </div>
  <!-- Internet Connection Status-->
  <div class="internet-connection-status" id="internetStatus"></div>
  <!-- Footer Nav-->
  <div class="footer-nav-area" id="footerNav">
    <div class="container h-100 px-0">
      <div class="suha-footer-nav h-100">
        <ul class="h-100 d-flex align-items-center justify-content-between ps-0">
          <li class="active"><a href="#"><i class="lni lni-home"></i>Trang chủ</a></li>
          <li><a href="./cart.html"><i class="fa fa-cart-arrow-down" aria-hidden="true"></i>Giỏ hàng</a></li>
          <li><a href="./thongbao.html"><i class="fa fa-bell-o" aria-hidden="true"></i>Thông báo</a></li>
          <li><a href="settings.html"><i class="fa fa-list" aria-hidden="true"></i>Danh mục</a></li>
        </ul>
      </div>
    </div>
  </div>
  <!-- All JavaScript Files-->
  <script src="assets/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/waypoints.min.js"></script>
  <script src="assets/js/jquery.easing.min.js"></script>
  <script src="assets/js/owl.carousel.min.js"></script>
  <script src="assets/js/jquery.counterup.min.js"></script>
  <script src="assets/js/jquery.countdown.min.js"></script>
  <script src="assets/js/default/jquery.passwordstrength.js"></script>
  <script src="assets/js/default/dark-mode-switch.js"></script>
  <script src="assets/js/default/no-internet.js"></script>
  <script src="assets/js/default/active.js"></script>
  <script src="assets/js/pwa.js"></script>
  <script>
    var hoadon;

    $(document).ready(function () {
      showData();

    })

    function showData() {
      $.ajax({
        'url': 'http://10.0.2.2:3000/donhang',
        'type': 'get',
      }).done(function (response) {
        console.log(response);
        $('#list').empty();
        response.reverse().forEach((data, index) => {
          let sp = '';
          let gt = 0;
          let cl = '';
          if(data.hang_hoa.length > 0){
              data.hang_hoa.forEach((d,i) =>{
              sp+= `<div class="single-profile-data d-flex align-items-center justify-content-between">
                      <div class="content"><i class="lni lni-star-filled"></i>&nbsp;&nbsp;<span>${d.mo_ta} x ${d.so_luong}</span></div>
                    </div>`;
              gt += parseInt(d.gia_tri);
            })
          }else{
            sp+= `<div class="single-profile-data d-flex align-items-center justify-content-between">
                      <div class="content"><i class="lni lni-star-filled"></i>&nbsp;&nbsp;<span>${data.hang_hoa.mo_ta} x ${data.hang_hoa.so_luong}</span></div>
                    </div>`;
          }
          if(data.trang_thai == 'Đã hủy'){
            cl = 'disabled';
          }
          let htm = `<div class="billing-information-card mb-3">
                      <div class="card shipping-method-choose-title-card bg-success">
                        <div class="card-body">
                          <h6 class="text-center mb-0 text-white">${data.ma_don_hang} * ${data.trang_thai}</h6>
                        </div>
                      </div>
                      <div class="card user-data-card">
                        <div class="card-body">                                   
                          <div class="single-profile-data d-flex align-items-center justify-content-between">
                            <div class="content"><i class="lni lni-user"></i>&nbsp;&nbsp;<span>${data.nguoi_nhan}</span></div>
                          </div>
                          <div class="single-profile-data d-flex align-items-center justify-content-between">
                            <div class="content"><i class="lni lni-phone"></i>&nbsp;&nbsp;<span>${data.sdt_nguoi_nhan}</span></div>
                          </div>
                          <div class="single-profile-data d-flex align-items-center justify-content-between">
                            <div class="content"><i class="lni lni-map-marker"></i>&nbsp;&nbsp;<span>${data.dia_chi}</span></div>
                          </div>
                          ` + sp +`
                          <div class="single-profile-data d-flex align-items-center justify-content-between">
                            <div class="content"><i class="lni lni-dollar"></i>&nbsp;&nbsp;<span>${gt}đ</span></div>

                          </div>
                          <!-- Edit Address-->
                          <div class="gr-btn">
                            <button class="btn" onclick="copy(${data.ma_don_hang})">Sao chép đơn</button>
                            <a href="./suadonhang.html?id=${data.id}"><button class="btn">Sửa đơn</button></a>
                            <button class="btn" ${cl} onclick="cancel(${data.id})">Hủy đơn</button>
                          </div>
                        </div>
                      </div>
                    </div>`;
          $('#list').append(htm);
        });
      })
    }

    function cancel(id) {
      let cf = confirm('Bạn có muốn hủy đơn hàng không?');
      if(cf){
        axios({
          'url': 'http://10.0.2.2:3000/donhang/'+id,
          'method': 'patch',
          'data':{
            'trang_thai': 'Đã hủy'
          }
        }).then(function(response) {
          alert('Hủy đơn hàng thành công!');
          showData()
        }).catch(function(err) {
          console.log(err);
        })
        
      }
    }

    function copy(code) {
      alert("Sao chép đơn hàng " + code + " thành công!");
    }
  </script>
</body>

</html>